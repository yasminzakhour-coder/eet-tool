<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Interactive EET Practice - Dan</title>

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;700;800&display=swap"
			rel="stylesheet"
		/>

		<style>
			:root {
				--bg: #0b1220;
				--panel: #0f1a30;
				--panel2: #122042;
				--text: #eaf0ff;
				--muted: rgba(234, 240, 255, 0.74);
				--border: rgba(234, 240, 255, 0.14);
				--shadow: 0 10px 28px rgba(0, 0, 0, 0.35);

				--brand: #6ee7ff;
				--brand2: #a78bfa;
				--ok: #34d399;
				--warn: #fbbf24;
				--danger: #fb7185;

				--radius: 16px;
				--tap: 48px;
				--maxw: 1050px;
			}

			*,
			*::before,
			*::after {
				box-sizing: border-box;
			}

			html,
			body {
				height: 100%;
			}

			body {
				margin: 0;
				font-family: Nunito, ui-rounded, system-ui, -apple-system, Segoe UI, Roboto,
					Arial, sans-serif;
				background: radial-gradient(1000px 800px at 15% -10%, rgba(110, 231, 255, 0.15), transparent 60%),
					radial-gradient(900px 700px at 110% 10%, rgba(167, 139, 250, 0.18), transparent 55%),
					var(--bg);
				color: var(--text);
			}

			.container {
				max-width: 100%;
				margin: 0 auto;
				padding: 18px 24px 28px;
			}

			.header {
				display: flex;
				flex-direction: column;
				gap: 10px;
				padding: 18px 18px 14px;
				border: 1px solid var(--border);
				border-radius: var(--radius);
				background: linear-gradient(180deg, rgba(15, 26, 48, 0.9), rgba(15, 26, 48, 0.7));
				box-shadow: var(--shadow);
			}

			.header-top {
				display: flex;
				flex-wrap: wrap;
				gap: 10px 12px;
				align-items: center;
				justify-content: space-between;
			}

			.h1 {
				font-size: 22px;
				line-height: 1.1;
				margin: 0;
				letter-spacing: 0.2px;
				color: rgba(255, 255, 255, 0.92);
			}

			.welcome {
				margin: 0;
				color: var(--muted);
				font-size: 15px;
			}

			.badge {
				display: inline-flex;
				align-items: center;
				gap: 8px;
				padding: 8px 12px;
				border-radius: 999px;
				border: 1px solid var(--border);
				background: rgba(18, 32, 66, 0.65);
				color: var(--muted);
				font-size: 13px;
			}

			.badge strong {
				color: var(--text);
			}

			.main {
				margin-top: 16px;
				display: grid;
				grid-template-columns: 1fr;
				gap: 16px;
			}

			.panel {
				border: 1px solid var(--border);
				border-radius: var(--radius);
				background: rgba(15, 26, 48, 0.74);
				box-shadow: var(--shadow);
				overflow: hidden;
			}

			.panel-header {
				padding: 14px 14px 10px;
				border-bottom: 1px solid rgba(234, 240, 255, 0.08);
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 12px;
			}

			.panel-title {
				margin: 0;
				font-size: 16px;
				letter-spacing: 0.2px;
			}

			.panel-body {
				padding: 14px;
			}

			.bead-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
				gap: 12px;
			}

			.bead-card {
				min-height: 150px;
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.14);
				background: linear-gradient(180deg, rgba(18, 32, 66, 0.85), rgba(18, 32, 66, 0.55));
				color: var(--text);
				box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
				cursor: pointer;
				padding: 20px 18px 18px;
				display: flex;
				flex-direction: column;
				gap: 8px;
				text-align: left;
				user-select: none;
				touch-action: manipulation;
			}

			.bead-card:focus-visible {
				outline: 3px solid rgba(110, 231, 255, 0.65);
				outline-offset: 2px;
			}

			.bead-card:hover {
				transform: translateY(-1px);
				border-color: rgba(110, 231, 255, 0.45);
			}

			.bead-card.active {
				border-color: rgba(110, 231, 255, 0.75);
				box-shadow: 0 10px 22px rgba(110, 231, 255, 0.12), 0 10px 22px rgba(0, 0, 0, 0.25);
			}

			.bead-title {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 10px;
			}

			.bead-title h3 {
				margin: 0;
				font-size: 20px;
				letter-spacing: 0.2px;
			}

			.bead-question {
				margin: 0;
				font-size: 16px;
				font-weight: 700;
				letter-spacing: 0.2px;
			}

			.bead-pill {
				font-size: 12px;
				border: 1px solid rgba(234, 240, 255, 0.14);
				border-radius: 999px;
				padding: 5px 10px;
				color: rgba(234, 240, 255, 0.82);
				background: rgba(11, 18, 32, 0.5);
			}

			.bead-sub {
				margin: 0;
				color: var(--muted);
				font-size: 14px;
				line-height: 1.3;
				min-height: 40px;
			}

			.bead-card[data-bead="group"] {
				background: linear-gradient(180deg, #2ec17b, #1d8f5a);
				border-color: rgba(0, 0, 0, 0.2);
				color: #0b1220;
			}

			.bead-card[data-bead="do"] {
				background: linear-gradient(180deg, #3b82f6, #1d4ed8);
				border-color: rgba(255, 255, 255, 0.2);
			}

			.bead-card[data-bead="looksLike"] {
				background: linear-gradient(180deg, #111827, #030712);
				border-color: rgba(255, 255, 255, 0.1);
			}

			.bead-card[data-bead="madeOf"] {
				background: linear-gradient(180deg, #9a6b45, #6f4a2f);
				border-color: rgba(0, 0, 0, 0.25);
			}

			.bead-card[data-bead="parts"] {
				background: linear-gradient(180deg, #f472b6, #ec4899);
				border-color: rgba(255, 255, 255, 0.25);
			}

			.bead-card[data-bead="where"] {
				background: linear-gradient(180deg, #ffffff, #e5e7eb);
				border-color: rgba(0, 0, 0, 0.15);
				color: #0b1220;
			}

			.bead-card[data-bead="extra"] {
				background: linear-gradient(180deg, #fb923c, #f97316);
				border-color: rgba(0, 0, 0, 0.2);
				color: #0b1220;
			}

			.bead-card[data-bead="group"] .bead-sub,
			.bead-card[data-bead="where"] .bead-sub,
			.bead-card[data-bead="extra"] .bead-sub {
				color: rgba(11, 18, 32, 0.75);
			}

			.controls {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
			}

			.btn {
				height: var(--tap);
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.16);
				background: rgba(18, 32, 66, 0.85);
				color: var(--text);
				padding: 0 14px;
				font-weight: 800;
				letter-spacing: 0.2px;
				cursor: pointer;
				user-select: none;
				touch-action: manipulation;
			}

			.btn:focus-visible {
				outline: 3px solid rgba(167, 139, 250, 0.6);
				outline-offset: 2px;
			}

			.btn.primary {
				border-color: rgba(110, 231, 255, 0.35);
				background: linear-gradient(180deg, rgba(110, 231, 255, 0.18), rgba(110, 231, 255, 0.06)),
					rgba(18, 32, 66, 0.7);
			}

			.btn.secondary {
				border-color: rgba(167, 139, 250, 0.35);
				background: linear-gradient(180deg, rgba(167, 139, 250, 0.18), rgba(167, 139, 250, 0.06)),
					rgba(18, 32, 66, 0.7);
			}

			.btn.ghost {
				background: transparent;
			}

			.builder-placeholder {
				color: var(--muted);
				font-size: 15px;
				line-height: 1.45;
				padding: 12px;
				border-radius: 14px;
				border: 1px dashed rgba(234, 240, 255, 0.22);
				background: rgba(11, 18, 32, 0.25);
			}

			.builder-output {
				display: grid;
				gap: 12px;
			}

			.output-box {
				padding: 12px;
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.12);
				background: rgba(11, 18, 32, 0.35);
			}

			.output-label {
				margin: 0 0 6px;
				font-size: 13px;
				color: rgba(234, 240, 255, 0.8);
			}

			.output-text {
				margin: 0;
				font-size: 16px;
				line-height: 1.4;
				white-space: pre-wrap;
			}

			.answer-list {
				margin: 0;
				padding-left: 18px;
				display: grid;
				gap: 8px;
			}

			.answer-list li {
				line-height: 1.35;
			}

			.answer-list strong {
				color: rgba(110, 231, 255, 0.92);
			}

			/* Modal */
			.modal-overlay {
				position: fixed;
				inset: 0;
				background: rgba(0, 0, 0, 0.55);
				backdrop-filter: blur(6px);
				display: none;
				align-items: stretch;
				justify-content: center;
				z-index: 50;
			}

			.modal-overlay.open {
				display: flex;
			}

			.modal {
				width: 100%;
				height: 100%;
				background: linear-gradient(180deg, rgba(11, 18, 32, 0.88), rgba(11, 18, 32, 0.98));
				display: flex;
				flex-direction: column;
			}

			.modal-header {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 10px;
				padding: 14px 14px 10px;
				border-bottom: 1px solid rgba(234, 240, 255, 0.08);
			}

			.modal-title {
				margin: 0;
				font-size: 18px;
				letter-spacing: 0.2px;
			}

			.modal-close {
				width: var(--tap);
				height: var(--tap);
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.16);
				background: rgba(18, 32, 66, 0.75);
				color: var(--text);
				font-size: 18px;
				font-weight: 900;
				cursor: pointer;
				touch-action: manipulation;
			}

			.modal-body {
				padding: 14px;
				overflow: hidden;
				display: grid;
				gap: 14px;
			}

			.prompt {
				padding: 12px;
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.12);
				background: rgba(18, 32, 66, 0.45);
				color: rgba(234, 240, 255, 0.92);
				font-size: 15px;
				line-height: 1.4;
			}

			.choice-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 10px;
			}

			.choice-tile {
				position: relative;
				min-height: clamp(96px, 14vw, 150px);
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.14);
				background: linear-gradient(180deg, rgba(18, 32, 66, 0.85), rgba(18, 32, 66, 0.55));
				padding: clamp(10px, 1.6vw, 16px);
				cursor: pointer;
				user-select: none;
				touch-action: manipulation;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				gap: clamp(6px, 1.2vw, 10px);
			}

			.choice-tile:hover {
				border-color: rgba(110, 231, 255, 0.35);
			}

			.choice-tile.selected {
				border-color: rgba(52, 211, 153, 0.8);
				box-shadow: 0 0 0 2px rgba(52, 211, 153, 0.15) inset;
			}

			.choice-tile.crossed {
				opacity: 0.52;
				text-decoration: line-through;
				text-decoration-thickness: 2px;
			}

			.choice-label {
				font-size: clamp(18px, 3vw, 26px);
				font-weight: 800;
				letter-spacing: 0.2px;
				padding-left: clamp(8px, 1.2vw, 14px);
				padding-right: clamp(8px, 1.2vw, 14px);
				display: block;
				text-align: center;
				color: rgba(234, 240, 255, 0.92);
			}

			.choice-image {
				width: clamp(100px, 18vw, 160px);
				height: clamp(70px, 13vw, 120px);
				border-radius: 10px;
				object-fit: cover;
				box-shadow: 0 8px 14px rgba(0, 0, 0, 0.35);
				user-select: none;
				pointer-events: none;
			}

			@media (max-width: 720px), (max-height: 720px) {
				.choice-grid {
					grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
				}
				.choice-tile {
					min-height: 92px;
					padding: 8px 8px 10px;
					gap: 6px;
				}
				.choice-label {
					font-size: 18px;
				}
				.choice-image {
					width: 96px;
					height: 64px;
				}
			}

			@media (max-width: 560px), (max-height: 620px) {
				.choice-grid {
					grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
					gap: 6px;
				}
				.choice-tile {
					min-height: 84px;
					padding: 6px 6px 8px;
				}
				.choice-label {
					font-size: 16px;
				}
				.choice-image {
					display: none;
				}
			}

			.choice-x {
				position: absolute;
				top: 8px;
				left: 8px;
				width: 34px;
				height: 34px;
				border-radius: 10px;
				border: 1px solid rgba(234, 240, 255, 0.16);
				background: rgba(11, 18, 32, 0.35);
				color: rgba(234, 240, 255, 0.9);
				font-weight: 900;
				cursor: pointer;
				touch-action: manipulation;
			}

			.choice-plus {
				position: absolute;
				top: 8px;
				right: 8px;
				width: 34px;
				height: 34px;
				border-radius: 10px;
				border: 1px solid rgba(52, 211, 153, 0.55);
				background: rgba(52, 211, 153, 0.18);
				color: rgba(234, 240, 255, 0.95);
				font-weight: 900;
				display: none;
				align-items: center;
				justify-content: center;
				pointer-events: none;
			}

			.choice-tile.selected .choice-plus {
				display: flex;
			}

			textarea {
				width: 100%;
				min-height: clamp(45px, 7vw, 70px);
				border-radius: 14px;
				border: 1px solid rgba(234, 240, 255, 0.16);
				background: rgba(18, 32, 66, 0.4);
				color: var(--text);
				padding: 12px;
				font-size: clamp(8px, 1.2vw, 12px);
				line-height: 1.4;
				resize: vertical;
			}

			textarea:focus-visible {
				outline: 3px solid rgba(110, 231, 255, 0.45);
				outline-offset: 2px;
			}

			.modal-actions {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				padding: 12px 14px 16px;
				border-top: 1px solid rgba(234, 240, 255, 0.08);
				background: rgba(11, 18, 32, 0.65);
			}

			.modal-actions .btn {
				flex: 1 1 180px;
			}

			@media (min-width: 980px) {
				.main {
					grid-template-columns: 1.2fr 0.8fr;
					align-items: start;
				}
				.modal {
					max-width: 1200px;
					width: calc(100% - 48px);
					margin: 24px auto;
					height: calc(100% - 48px);
					border-radius: var(--radius);
					border: 1px solid rgba(234, 240, 255, 0.14);
					box-shadow: var(--shadow);
					overflow: hidden;
				}
			}

			@media print {
				body {
					background: white;
					color: black;
				}
				.header,
				#beadsPanel,
				#builderControls,
				.modal-overlay {
					display: none !important;
				}
				.container {
					max-width: none;
					padding: 0;
				}
				.panel {
					border: none;
					box-shadow: none;
					background: transparent;
				}
				.output-box {
					border: 1px solid #ddd;
					background: transparent;
				}
				.answer-list strong {
					color: black;
				}
			}
		</style>
	</head>

	<body>
		<div class="container">
			<header class="header" id="appHeader">
				<div class="header-top">
					<h1 class="h1" id="pageTitle">Interactive EET Practice - Dan</h1>
					<div class="badge" id="progressBadge">
						<strong id="answeredCount">0</strong>
						<span>/</span>
						<span id="totalCount">7</span>
						<span>beads saved</span>
					</div>
				</div>
				<p class="welcome" id="welcomeMessage">
					Tap a bead, pick words, or type your own answer. Then build your description!
				</p>
			</header>

			<main class="main">
				<section class="panel" id="beadsPanel">
					<div class="panel-header">
						<h2 class="panel-title">Beads</h2>
					</div>
					<div class="panel-body">
						<div class="bead-grid" id="beadGrid"></div>
					</div>
				</section>

				<section class="panel" id="builderPanel">
					<div class="panel-header">
						<h2 class="panel-title">Build My Description</h2>
					</div>
					<div class="panel-body">
						<div class="builder-output" id="builderOutput"></div>
						<div class="controls" id="builderControls" style="margin-top: 12px">
							<button class="btn primary" id="buildBtn" type="button">
								Build My Description
							</button>
							<button class="btn secondary" id="printBtn" type="button">
								Print My Work
							</button>
						</div>
					</div>
				</section>
			</main>
		</div>

		<div class="modal-overlay" id="modalOverlay" aria-hidden="true">
			<div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
				<div class="modal-header">
					<h2 class="modal-title" id="modalTitle">Bead</h2>
					<button class="modal-close" id="modalCloseBtn" type="button" aria-label="Close">
						×
					</button>
				</div>

				<div class="modal-body">
					<div class="prompt" id="modalPrompt"></div>
					<div class="choice-grid" id="choiceGrid"></div>
					<div>
						<textarea
							id="answerTextarea"
							placeholder="Type your answer here…"
							aria-label="Answer text"
						></textarea>
					</div>
				</div>

				<div class="modal-actions">
					<button class="btn ghost" id="readAloudBtn" type="button">
						Read Aloud
					</button>
					<button class="btn primary" id="saveAnswerBtn" type="button">
						Save Answer
					</button>
					<button class="btn secondary" id="closeAnswerBtn" type="button">
						Close
					</button>
				</div>
			</div>
		</div>

		<!-- Optional platform hooks (safe if missing) -->
		<script
			src="./element_sdk.js"
			onerror="console.info('[EET] element_sdk.js not found (ok for local use).')"
		></script>
		<script
			src="./data_sdk.js"
			onerror="console.info('[EET] data_sdk.js not found (ok for local use).')"
		></script>

				<script>
			(() => {
				"use strict";

				// -----------------------------
				// Data model
				// -----------------------------
				const beadOrder = ["group", "do", "looksLike", "madeOf", "parts", "where", "extra"];

				const beadData = {
					group: {
						title: "Group",
						prompt: "What is it?",
						question: "What is it?",
						starter: "It is a",
						choices: ["animal", "food", "person", "thing"],
					},
					do: {
						title: "Do",
						prompt: "What does it do?",
						question: "What does it do?",
						starter: "It can",
						choices: ["move", "fly", "swim", "roll"],
					},
					looksLike: {
						title: "Looks Like",
						prompt: "What does it look like?",
						question: "What does it look like?",
						starter: "It looks like",
						choices: ["big", "small", "colorful", "round"],
					},
					madeOf: {
						title: "Made Of",
						prompt: "What is it made of?",
						question: "What is it made of?",
						starter: "It is made of",
						choices: ["fur", "bones", "wood", "plastic"],
					},
					parts: {
						title: "Parts",
						prompt: "What are its parts?",
						question: "What are its parts?",
						starter: "It has",
						choices: ["eyes", "mouth", "wheels", "buttons"],
					},
					where: {
						title: "Where",
						prompt: "Where do you find it?",
						question: "Where do you find it?",
						starter: "You find it",
						choices: ["at home", "at school", "outside", "in a store"],
					},
					extra: {
						title: "Extra",
						prompt: "Tell me more!",
						question: "Tell me more!",
						starter: "Something extra is",
						choices: ["quiet", "loud", "fast", "slow"],
					},
				};

				// In-memory state (no localStorage)
				const answers = {};
				const drafts = {};
				const choiceState = {};
				for (const beadKey of beadOrder) {
					choiceState[beadKey] = {
						selectedChoice: null,
						crossed: new Set(),
					};
				}

				let activeBeadKey = null;
				let hasBuilt = false;

				// -----------------------------
				// Elements
				// -----------------------------
				const el = {
					pageTitle: document.getElementById("pageTitle"),
					welcomeMessage: document.getElementById("welcomeMessage"),
					beadGrid: document.getElementById("beadGrid"),
					builderOutput: document.getElementById("builderOutput"),
					buildBtn: document.getElementById("buildBtn"),
					printBtn: document.getElementById("printBtn"),
					answeredCount: document.getElementById("answeredCount"),
					totalCount: document.getElementById("totalCount"),

					modalOverlay: document.getElementById("modalOverlay"),
					modalTitle: document.getElementById("modalTitle"),
					modalPrompt: document.getElementById("modalPrompt"),
					choiceGrid: document.getElementById("choiceGrid"),
					answerTextarea: document.getElementById("answerTextarea"),
					modalCloseBtn: document.getElementById("modalCloseBtn"),
					closeAnswerBtn: document.getElementById("closeAnswerBtn"),
					saveAnswerBtn: document.getElementById("saveAnswerBtn"),
					readAloudBtn: document.getElementById("readAloudBtn"),
				};

				// -----------------------------
				// Helpers
				// -----------------------------
				function countSavedAnswers() {
					let n = 0;
					for (const beadKey of beadOrder) {
						if (answers[beadKey] && answers[beadKey].trim().length > 0) n += 1;
					}
					return n;
				}

				function summarizeAnswer(text) {
					if (!text) return "Tap to add an answer";
					const t = text.trim();
					if (t.length <= 48) return t;
					return t.slice(0, 45) + "…";
				}

				function buildCombinedText() {
					const parts = [];
					for (const beadKey of beadOrder) {
						const t = (answers[beadKey] || "").trim();
						if (t) parts.push(t);
					}
					return parts.join(" ");
				}

				function safeCancelSpeech() {
					try {
						if ("speechSynthesis" in window) window.speechSynthesis.cancel();
					} catch (_e) {
						// ignore
					}
				}

				function speakText(text) {
					if (!("speechSynthesis" in window)) return;
					safeCancelSpeech();
					const utter = new SpeechSynthesisUtterance(text);
					utter.rate = 0.95;
					utter.pitch = 1.0;
					window.speechSynthesis.speak(utter);
				}

				// -----------------------------
				// Rendering
				// -----------------------------
				function renderProgress() {
					el.answeredCount.textContent = String(countSavedAnswers());
					el.totalCount.textContent = String(beadOrder.length);
				}

				function renderBeadGrid() {
					el.beadGrid.innerHTML = "";

					for (const beadKey of beadOrder) {
						const bead = beadData[beadKey];
						const btn = document.createElement("button");
						btn.type = "button";
						btn.className = "bead-card" + (activeBeadKey === beadKey ? " active" : "");
						btn.setAttribute("data-bead", beadKey);

						const titleRow = document.createElement("div");
						titleRow.className = "bead-title";

						const h3 = document.createElement("h3");
						h3.textContent = bead.title;

						const pill = document.createElement("span");
						pill.className = "bead-pill";
						pill.textContent = answers[beadKey] && answers[beadKey].trim() ? "Saved" : "Practice";

						titleRow.appendChild(h3);
						titleRow.appendChild(pill);

						const question = document.createElement("p");
						question.className = "bead-question";
						question.textContent = bead.question || bead.prompt || "";

						const sub = document.createElement("p");
						sub.className = "bead-sub";
						sub.textContent = summarizeAnswer(answers[beadKey]);

						btn.appendChild(titleRow);
						btn.appendChild(question);
						btn.appendChild(sub);

						btn.addEventListener("click", () => openModal(beadKey));
						el.beadGrid.appendChild(btn);
					}
				}

				function renderBuilder() {
					const saved = [];
					for (const beadKey of beadOrder) {
						const text = (answers[beadKey] || "").trim();
						if (text) saved.push({ beadKey, text });
					}

					if (!hasBuilt || saved.length === 0) {
						el.builderOutput.innerHTML = "";
						const ph = document.createElement("div");
						ph.className = "builder-placeholder";
						ph.textContent =
							"Nothing built yet. Tap beads to save answers, then press “Build My Description”.";
						el.builderOutput.appendChild(ph);
						return;
					}

					el.builderOutput.innerHTML = "";

					const combined = buildCombinedText();
					const box1 = document.createElement("div");
					box1.className = "output-box";
					box1.innerHTML =
						'<p class="output-label">My Description</p><p class="output-text" id="combinedText"></p>';
					box1.querySelector("#combinedText").textContent = combined || "";

					const box2 = document.createElement("div");
					box2.className = "output-box";
					box2.innerHTML = '<p class="output-label">Saved Bead Answers</p><ol class="answer-list" id="answerList"></ol>';
					const list = box2.querySelector("#answerList");
					for (const item of saved) {
						const li = document.createElement("li");
						li.innerHTML = `<strong>${beadData[item.beadKey].title}:</strong> ${escapeHtml(item.text)}`;
						list.appendChild(li);
					}

					el.builderOutput.appendChild(box1);
					el.builderOutput.appendChild(box2);
				}

				function renderModal() {
					if (!activeBeadKey) return;
					const bead = beadData[activeBeadKey];
					const state = choiceState[activeBeadKey];

					el.modalTitle.textContent = bead.title;
					el.modalPrompt.textContent = bead.prompt;
					el.answerTextarea.value = drafts[activeBeadKey] ?? (answers[activeBeadKey] || "");

					el.choiceGrid.innerHTML = "";
					for (const choice of bead.choices) {
						const tile = document.createElement("div");
						tile.className = "choice-tile";
						tile.setAttribute("role", "button");
						tile.setAttribute("tabindex", "0");
						tile.setAttribute("aria-label", `${choice}`);

						const crossed = state.crossed.has(choice);
						const selected = state.selectedChoice === choice;
						if (crossed) tile.classList.add("crossed");
						if (selected) tile.classList.add("selected");

						const xBtn = document.createElement("button");
						xBtn.type = "button";
						xBtn.className = "choice-x";
						xBtn.textContent = "X";
						xBtn.setAttribute("aria-label", "Cross off");
						xBtn.addEventListener("click", (e) => {
							e.stopPropagation();
							toggleCross(choice);
						});

						const plus = document.createElement("div");
						plus.className = "choice-plus";
						plus.textContent = "+";

						const img = document.createElement("img");
						img.className = "choice-image";
						img.alt = `${choice} photo`;
						img.loading = "lazy";
						img.decoding = "async";
						const safeChoice = String(choice || "object").replaceAll(" ", "_");
						const fileBase = `${activeBeadKey}__${safeChoice}`;
						img.src = `./assets/choices/${fileBase}.png`;
						img.addEventListener("error", () => {
							img.src = `./assets/choices/${fileBase}.jpg`;
						});
						img.setAttribute("aria-hidden", "true");

						const label = document.createElement("span");
						label.className = "choice-label";
						label.textContent = choice;

						tile.appendChild(xBtn);
						tile.appendChild(plus);
						tile.appendChild(img);
						tile.appendChild(label);

						tile.addEventListener("click", () => selectChoice(choice));
						tile.addEventListener("keydown", (e) => {
							if (e.key === "Enter" || e.key === " ") {
								e.preventDefault();
								selectChoice(choice);
							}
						});

						el.choiceGrid.appendChild(tile);
					}
				}

				function escapeHtml(s) {
					return String(s)
						.replaceAll("&", "&amp;")
						.replaceAll("<", "&lt;")
						.replaceAll(">", "&gt;")
						.replaceAll('"', "&quot;")
						.replaceAll("'", "&#039;");
				}

				// -----------------------------
				// Modal open/close
				// -----------------------------
				function openModal(beadKey) {
					activeBeadKey = beadKey;
					if (drafts[beadKey] === undefined) drafts[beadKey] = answers[beadKey] || "";
					renderBeadGrid();
					renderModal();

					el.modalOverlay.classList.add("open");
					el.modalOverlay.setAttribute("aria-hidden", "false");

					setTimeout(() => {
						el.answerTextarea.focus();
					}, 0);
				}

				function closeModal() {
					const beadKey = activeBeadKey;
					safeCancelSpeech();
					if (beadKey) drafts[beadKey] = answers[beadKey] || "";
					activeBeadKey = null;
					el.modalOverlay.classList.remove("open");
					el.modalOverlay.setAttribute("aria-hidden", "true");
					renderBeadGrid();
				}

				// Close on backdrop tap
				el.modalOverlay.addEventListener("click", (e) => {
					if (e.target === el.modalOverlay) closeModal();
				});

				// Close on ESC
				document.addEventListener("keydown", (e) => {
					if (e.key === "Escape" && el.modalOverlay.classList.contains("open")) closeModal();
				});

				el.modalCloseBtn.addEventListener("click", closeModal);
				el.closeAnswerBtn.addEventListener("click", closeModal);

				el.answerTextarea.addEventListener("input", () => {
					if (!activeBeadKey) return;
					drafts[activeBeadKey] = el.answerTextarea.value;
				});

				// -----------------------------
				// Choice behavior (+ / X)
				// -----------------------------
				function toggleCross(choice) {
					if (!activeBeadKey) return;
					const state = choiceState[activeBeadKey];

					if (state.crossed.has(choice)) {
						state.crossed.delete(choice);
					} else {
						state.crossed.add(choice);
						if (state.selectedChoice === choice) {
							// If you cross off the selected choice, unselect it, but do NOT touch the textarea.
							state.selectedChoice = null;
						}
					}
					renderModal();
				}

				function selectChoice(choice) {
					if (!activeBeadKey) return;
					const bead = beadData[activeBeadKey];
					const state = choiceState[activeBeadKey];

					state.selectedChoice = choice;
					state.crossed.delete(choice);

					const starter = (bead.starter || "").trim();
					const text = starter ? `${starter} ${choice}` : choice;
					drafts[activeBeadKey] = text;
					el.answerTextarea.value = text;
					renderModal();
				}

				// -----------------------------
				// Save / Build / Print / Read
				// -----------------------------
				el.saveAnswerBtn.addEventListener("click", () => {
					if (!activeBeadKey) return;
					const text = (drafts[activeBeadKey] ?? el.answerTextarea.value).trim();
					if (text) answers[activeBeadKey] = text;
					else delete answers[activeBeadKey];
					drafts[activeBeadKey] = answers[activeBeadKey] || "";

					renderProgress();
					renderBeadGrid();
					if (hasBuilt) renderBuilder();
					closeModal();
				});

				el.readAloudBtn.addEventListener("click", () => {
					if (!activeBeadKey) return;
					const bead = beadData[activeBeadKey];
					const typed = el.answerTextarea.value.trim();
					const speak = typed
						? `${bead.title}. ${bead.prompt} Your answer is: ${typed}.`
						: `${bead.title}. ${bead.prompt}`;
					speakText(speak);
				});

				el.buildBtn.addEventListener("click", () => {
					hasBuilt = true;
					renderBuilder();
				});

				el.printBtn.addEventListener("click", () => {
					window.print();
				});

				// -----------------------------
				// Optional Element SDK hooks
				// -----------------------------
				const defaultConfig = {
					page_title: "Interactive EET Practice - Dan",
					welcome_message:
						"Tap a bead, pick words, or type your own answer. Then build your description!",
				};

				function applyConfig(cfg) {
					const pageTitle = (cfg && cfg.page_title) || defaultConfig.page_title;
					const welcome = (cfg && cfg.welcome_message) || defaultConfig.welcome_message;
					el.pageTitle.textContent = pageTitle;
					document.title = pageTitle;
					el.welcomeMessage.textContent = welcome;
				}

				function tryInitElementSdk() {
					// We don’t assume an API. If your platform exposes a config object or change handler,
					// we’ll use it; otherwise we just run defaults.
					const w = window;
					applyConfig(defaultConfig);

					try {
						const maybeCfg =
							w.elementConfig || w.ELEMENT_CONFIG || w.appConfig || w.CONFIG || null;
						if (maybeCfg && typeof maybeCfg === "object") applyConfig(maybeCfg);
					} catch (_e) {
						// ignore
					}

					try {
						const sdk = w.elementSDK || w.ElementSDK || w.element_sdk || null;
						if (sdk && typeof sdk.onChange === "function") {
							sdk.onChange((nextCfg) => {
								if (nextCfg && typeof nextCfg === "object") applyConfig(nextCfg);
							});
						}
					} catch (_e) {
						// ignore
					}
				}

				// -----------------------------
				// Boot
				// -----------------------------
				renderProgress();
				renderBeadGrid();
				renderBuilder();
				tryInitElementSdk();
			})();
		</script>
</body>
</html>


